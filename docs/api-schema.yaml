openapi: 3.1.0
info:
  title: 교대근무 일정관리 (Shift Calendar) IPC API
  description: |
    Electron IPC 기반 교대근무 일정관리 앱의 API 스키마입니다.
    실제 통신은 Electron IPC(`ipcMain.handle` / `ipcRenderer.invoke`)를 사용하며,
    이 문서는 채널별 입출력을 OpenAPI 형식으로 정리한 참조 문서입니다.

    ## 핵심 원칙
    - **로컬 우선(Offline-First):** 모든 변경은 로컬 DB에 즉시 반영 후 Outbox를 통해 비동기 동기화
    - **충돌 해결:** `googleUpdatedAtUtc` vs `localEditedAtUtc` 타임스탬프 비교로 최신 버전 우선
    - **시간 규칙:** DB 저장은 UTC, UI/요청에는 `timeZone` 명시
    - **이벤트 타입:** Google `extendedProperties.private.shiftCalendarEventType`으로 양방향 동기화

    ## 동기화 흐름
    1. 로컬 변경 → Outbox 큐에 적재 → UI에 즉시 반영
    2. Outbox 워커가 비동기로 Google API에 전송
    3. 전송 직전 원격 이벤트 `GET` 조회 → 타임스탬프 비교 → 충돌 해결
    4. 실패 시 지수 백오프 재시도 (60초 → 5분 → 15분 → 60분)

    ## 반복 일정 편집 범위
    - `THIS`: 단일 인스턴스만 수정 (override 생성)
    - `ALL`: 전체 시리즈 수정
    - `FUTURE`: 편집 시점부터 시리즈 분할 (마스터 RRULE에 UNTIL 추가 + 새 시리즈 생성)
  version: 1.0.0
  contact:
    name: Shift Calendar
  license:
    name: Private
    identifier: UNLICENSED

servers:
  - url: ipc://electron
    description: Electron IPC (contextBridge)

tags:
  - name: Events
    description: 캘린더 이벤트 CRUD
  - name: Sync
    description: Google Calendar 동기화
  - name: Google
    description: Google OAuth 연결 관리
  - name: Calendar Selection
    description: Google 캘린더 선택
  - name: Shift Settings
    description: 교대근무 설정 관리
  - name: Window
    description: 윈도우 관리 (최소화/최대화/닫기)

paths:
  /calendar:list-events:
    post:
      operationId: listEvents
      tags: [Events]
      summary: 이벤트 목록 조회
      description: |
        로컬 DB에서 이벤트 목록을 조회합니다. 삭제된 이벤트(`isDeleted`)는 제외됩니다.
        시간 범위를 지정하면 해당 범위에 겹치는 이벤트만 반환합니다.
        결과는 `startAtUtc` 오름차순으로 정렬됩니다.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListEventsInput'
            examples:
              withRange:
                summary: 2026년 3월 이벤트 조회
                value:
                  rangeStartUtc: '2026-03-01T00:00:00.000Z'
                  rangeEndUtc: '2026-04-01T00:00:00.000Z'
              noFilter:
                summary: 전체 이벤트 조회
                value: {}
      responses:
        '200':
          description: 이벤트 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CalendarEvent'

  /calendar:upsert-event:
    post:
      operationId: upsertEvent
      tags: [Events]
      summary: 이벤트 생성 또는 수정
      description: |
        새 이벤트를 생성하거나 기존 이벤트를 수정합니다.

        ### 생성 (localId 미지정)
        - 새 UUID 기반 `localId`가 자동 생성됩니다.
        - Outbox에 `CREATE` 작업이 적재됩니다.

        ### 수정 (localId 지정)
        - 기존 이벤트를 찾아 수정합니다.
        - 반복 일정인 경우 `recurrenceScope`에 따라 동작이 달라집니다.

        ### 반복 일정 편집 범위 (`recurrenceScope`)

        | 범위 | 동작 | Outbox 작업 |
        |------|------|-------------|
        | `THIS` | 단일 인스턴스 override 생성 | `RECUR_THIS` |
        | `ALL` | 전체 시리즈 수정 (자식 인스턴스 포함) | `RECUR_ALL` |
        | `FUTURE` | 시리즈 분할: 마스터에 UNTIL 추가 + 새 시리즈 생성 | `RECUR_FUTURE` → `CREATE` (의존성 체인) |

        ### FUTURE 분할 상세
        1. 마스터 이벤트의 RRULE에 `UNTIL` 추가 (분할 시점 직전)
        2. 새 시리즈 이벤트 생성 (새 RRULE, 기존 COUNT/UNTIL 제거)
        3. Outbox에 `RECUR_FUTURE` 작업 적재 후, `CREATE` 작업이 의존성으로 연결
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpsertCalendarEventInput'
            examples:
              createSimple:
                summary: 단순 이벤트 생성
                value:
                  summary: 팀 미팅
                  description: 주간 업무 보고
                  location: 회의실 A
                  startAtUtc: '2026-03-10T01:00:00.000Z'
                  endAtUtc: '2026-03-10T02:00:00.000Z'
                  timeZone: Asia/Seoul
                  eventType: 일반
                  attendees: []
                  sendUpdates: none
              createRecurring:
                summary: 주간 반복 이벤트 생성
                value:
                  summary: 주간 회의
                  startAtUtc: '2026-03-10T01:00:00.000Z'
                  endAtUtc: '2026-03-10T02:00:00.000Z'
                  timeZone: Asia/Seoul
                  eventType: 반복업무
                  recurrenceRule: 'FREQ=WEEKLY;BYDAY=MO'
                  sendUpdates: none
              editThis:
                summary: 반복 일정 중 단일 인스턴스만 수정
                value:
                  localId: existing-local-id
                  summary: 변경된 미팅
                  startAtUtc: '2026-03-17T01:00:00.000Z'
                  endAtUtc: '2026-03-17T02:00:00.000Z'
                  timeZone: Asia/Seoul
                  eventType: 일반
                  recurrenceScope: THIS
                  sendUpdates: none
              editFuture:
                summary: 이 일정부터 이후 전체 수정 (시리즈 분할)
                value:
                  localId: existing-local-id
                  summary: 새 제목의 미팅
                  startAtUtc: '2026-04-07T01:00:00.000Z'
                  endAtUtc: '2026-04-07T02:00:00.000Z'
                  timeZone: Asia/Seoul
                  eventType: 일반
                  recurrenceRule: 'FREQ=WEEKLY;BYDAY=MO'
                  recurrenceScope: FUTURE
                  sendUpdates: none
              createVacation:
                summary: 휴가 이벤트 생성
                value:
                  summary: 연차
                  description: "휴가대상: 홍길동, 김철수\n휴가종류: 연차"
                  startAtUtc: '2026-03-15T00:00:00.000Z'
                  endAtUtc: '2026-03-16T00:00:00.000Z'
                  timeZone: Asia/Seoul
                  eventType: 휴가
                  sendUpdates: none
              createShift:
                summary: 근무 이벤트 생성
                value:
                  summary: '주간A 야간B'
                  startAtUtc: '2026-03-10T00:00:00.000Z'
                  endAtUtc: '2026-03-11T00:00:00.000Z'
                  timeZone: Asia/Seoul
                  eventType: 근무
                  sendUpdates: none
              createEducation:
                summary: 교육 이벤트 생성
                value:
                  summary: 안전 교육
                  description: "교육대상: 홍길동, 김철수\n교육 내용 상세"
                  startAtUtc: '2026-03-20T01:00:00.000Z'
                  endAtUtc: '2026-03-20T03:00:00.000Z'
                  timeZone: Asia/Seoul
                  eventType: 교육
                  sendUpdates: none
      responses:
        '200':
          description: 생성/수정된 이벤트
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalendarEvent'
        '400':
          description: 입력 유효성 검사 실패 (Zod validation error)

  /calendar:delete-event:
    post:
      operationId: deleteEvent
      tags: [Events]
      summary: 이벤트 삭제
      description: |
        이벤트를 소프트 삭제합니다 (`isDeleted = true`).
        반복 일정인 경우 `recurrenceScope`에 따라 동작이 달라집니다.

        | 범위 | 동작 |
        |------|------|
        | `ALL` | 전체 시리즈 및 자식 인스턴스 삭제 |
        | `THIS` | 단일 인스턴스만 삭제 |
        | `FUTURE` | 마스터 RRULE에 UNTIL 추가하여 이후 인스턴스 제거 |
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteCalendarEventInput'
            examples:
              deleteSimple:
                summary: 단일 이벤트 삭제
                value:
                  localId: event-local-id
                  sendUpdates: none
              deleteThisInstance:
                summary: 반복 일정 중 이 일정만 삭제
                value:
                  localId: event-local-id
                  sendUpdates: none
                  recurrenceScope: THIS
              deleteFuture:
                summary: 이 일정부터 이후 전체 삭제
                value:
                  localId: event-local-id
                  sendUpdates: none
                  recurrenceScope: FUTURE
      responses:
        '200':
          description: 삭제 결과
          content:
            application/json:
              schema:
                type: boolean
                description: 삭제 성공 여부 (이벤트가 없으면 false)

  /calendar:get-outbox-count:
    post:
      operationId: getOutboxCount
      tags: [Sync]
      summary: 대기 중인 동기화 작업 수 조회
      description: |
        Outbox에 대기 중인 동기화 작업(QUEUED, RUNNING, FAILED) 수를 반환합니다.
        UI에서 동기화 진행 상태 표시에 사용됩니다.
      responses:
        '200':
          description: Outbox 작업 수
          content:
            application/json:
              schema:
                type: integer
                minimum: 0
                example: 3

  /calendar:sync-now:
    post:
      operationId: syncNow
      tags: [Sync]
      summary: 즉시 동기화 실행
      description: |
        Google Calendar과 즉시 동기화를 실행합니다.

        ### 동기화 흐름
        1. Google 연결 상태 및 캘린더 선택 확인 → 미연결 시 `SKIPPED` 반환
        2. **Push:** Outbox 작업 처리 (로컬 변경 → Google 반영)
        3. **Pull:** 원격 이벤트 가져오기
           - `syncToken` 없음 → **FULL** 동기화 (전체 이벤트 + 한국 공휴일)
           - `syncToken` 있음 → **DELTA** 동기화 (증분 업데이트)
           - `syncToken` 만료 (HTTP 410) → **FULL** 동기화로 fallback

        ### 동기화 시간 범위
        - 시작: 현재 날짜 기준 5년 전
        - 종료: 현재 날짜 기준 12개월 후

        ### 한국 공휴일
        FULL 동기화 시 `ko.south_korea#holiday@group.v.calendar.google.com` 캘린더에서
        공휴일을 가져와 `eventType: '공휴일'`로 저장합니다.

        ### 주기적 동기화
        앱 실행 중 60초 간격으로 자동 동기화가 실행됩니다.
      responses:
        '200':
          description: 동기화 결과
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SyncResult'
              examples:
                fullSync:
                  summary: FULL 동기화 완료
                  value:
                    mode: FULL
                    pulledEvents: 150
                    pushedOutboxJobs: 2
                    outboxRemaining: 0
                deltaSync:
                  summary: DELTA 동기화 완료
                  value:
                    mode: DELTA
                    pulledEvents: 5
                    pushedOutboxJobs: 0
                    outboxRemaining: 0
                skipped:
                  summary: 동기화 건너뜀 (미연결)
                  value:
                    mode: SKIPPED
                    pulledEvents: 0
                    pushedOutboxJobs: 0
                    outboxRemaining: 0

  /calendar:connect-google:
    post:
      operationId: connectGoogle
      tags: [Google]
      summary: Google 계정 연결
      description: |
        Google OAuth 인증 흐름을 시작합니다.
        루프백 주소(127.0.0.1)를 사용하는 로컬 HTTP 서버를 열고
        브라우저에서 OAuth 동의 화면으로 리다이렉트합니다.
        인증 완료 후 토큰을 keytar에 안전하게 저장합니다.
      responses:
        '200':
          description: 연결 상태
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GoogleConnectionStatus'
              example:
                connected: true
                accountEmail: user@gmail.com

  /calendar:disconnect-google:
    post:
      operationId: disconnectGoogle
      tags: [Google]
      summary: Google 계정 연결 해제
      description: |
        저장된 OAuth 토큰을 삭제하고 Google 연결을 해제합니다.
        계정 이메일 정보도 함께 초기화됩니다.
      responses:
        '200':
          description: 연결 해제 상태
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GoogleConnectionStatus'
              example:
                connected: false
                accountEmail: null

  /calendar:get-google-connection-status:
    post:
      operationId: getGoogleConnectionStatus
      tags: [Google]
      summary: Google 연결 상태 조회
      description: 현재 Google OAuth 연결 상태와 연결된 계정 이메일을 반환합니다.
      responses:
        '200':
          description: 연결 상태
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GoogleConnectionStatus'

  /calendar:list-google-calendars:
    post:
      operationId: listGoogleCalendars
      tags: [Calendar Selection]
      summary: Google 캘린더 목록 조회
      description: |
        접근 가능한 Google 캘린더 목록을 반환합니다.
        `owner` 또는 `writer` 권한이 있는 캘린더만 포함됩니다.
        기본(primary) 캘린더가 목록 상단에 정렬됩니다.
        Google 미연결 시 빈 배열을 반환합니다.
      responses:
        '200':
          description: 캘린더 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GoogleCalendarItem'
              example:
                - id: primary
                  summary: 내 캘린더
                  primary: true
                  accessRole: owner
                - id: abcdef123@group.calendar.google.com
                  summary: 팀 캘린더
                  primary: false
                  accessRole: writer

  /calendar:get-selected-calendar:
    post:
      operationId: getSelectedCalendar
      tags: [Calendar Selection]
      summary: 선택된 캘린더 조회
      description: 현재 동기화 대상으로 설정된 Google 캘린더 정보를 반환합니다.
      responses:
        '200':
          description: 선택된 캘린더
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SelectedCalendar'

  /calendar:set-selected-calendar:
    post:
      operationId: setSelectedCalendar
      tags: [Calendar Selection]
      summary: 동기화 대상 캘린더 설정
      description: |
        동기화 대상 Google 캘린더를 변경합니다.

        ### 부수 효과
        캘린더가 변경되면 다음 작업이 자동 수행됩니다:
        1. 기존 Outbox 작업 전체 삭제
        2. 기존 로컬 이벤트 전체 삭제
        3. syncToken 초기화 (다음 동기화 시 FULL 동기화 수행)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetSelectedCalendarInput'
            example:
              calendarId: primary
              calendarSummary: 내 캘린더
      responses:
        '200':
          description: 변경된 캘린더 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SelectedCalendar'

  /calendar:get-shift-settings:
    post:
      operationId: getShiftSettings
      tags: [Shift Settings]
      summary: 교대근무 설정 조회
      description: |
        현재 교대근무 설정을 반환합니다.
        4개 팀(A/B/C/D) 구성, 팀 모드(1인/2인), 주간 근무자 정보를 포함합니다.
      responses:
        '200':
          description: 교대근무 설정
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShiftSettings'
              example:
                shiftType: DAY_NIGHT_OFF_OFF
                shiftTeamMode: PAIR
                dayWorkerCount: 2
                teams:
                  A: [홍길동, 김철수]
                  B: [이영희, 박민수]
                  C: [최수연, 정대현]
                  D: [강지은, 윤서준]
                dayWorkers: [한미래, 오태양]

  /calendar:set-shift-settings:
    post:
      operationId: setShiftSettings
      tags: [Shift Settings]
      summary: 교대근무 설정 변경
      description: |
        교대근무 설정을 저장합니다.

        ### 정규화 처리
        - SINGLE 모드: 팀당 최대 1명으로 제한
        - PAIR 모드: 팀당 최대 2명으로 제한
        - `dayWorkerCount` 범위 검증 (1~5)
        - 중복 멤버 이름 제거
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShiftSettings'
      responses:
        '200':
          description: 저장된 교대근무 설정
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShiftSettings'

  /window:minimize:
    post:
      operationId: windowMinimize
      tags: [Window]
      summary: 윈도우 최소화
      description: 앱 윈도우를 최소화합니다. (ipcMain.on, 반환값 없음)
      responses:
        '204':
          description: 실행 완료 (반환값 없음)

  /window:maximize:
    post:
      operationId: windowMaximize
      tags: [Window]
      summary: 윈도우 최대화/복원 토글
      description: |
        윈도우가 최대화 상태이면 복원하고, 아니면 최대화합니다.
        상태 변경 시 `window:maximize-changed` 이벤트가 발생합니다. (ipcMain.on, 반환값 없음)
      responses:
        '204':
          description: 실행 완료 (반환값 없음)

  /window:close:
    post:
      operationId: windowClose
      tags: [Window]
      summary: 윈도우 닫기
      description: 앱 윈도우를 닫습니다. (ipcMain.on, 반환값 없음)
      responses:
        '204':
          description: 실행 완료 (반환값 없음)

  /window:maximize-changed:
    get:
      operationId: onMaximizeChanged
      tags: [Window]
      summary: "[이벤트] 윈도우 최대화 상태 변경"
      description: |
        **Push 이벤트 (Main → Renderer)**

        윈도우 최대화/복원/전체화면 상태가 변경될 때 발생합니다.
        `window.windowApi.onMaximizeChanged(callback)` 으로 구독합니다.
      responses:
        '200':
          description: 최대화 상태
          content:
            application/json:
              schema:
                type: boolean
                description: 현재 최대화/전체화면 상태 여부

  /window:viewport-correction:
    get:
      operationId: onViewportCorrection
      tags: [Window]
      summary: "[이벤트] 뷰포트 보정값 변경"
      description: |
        **Push 이벤트 (Main → Renderer)**

        윈도우 최대화/전체화면 시 OS 인셋(inset)에 의한 뷰포트 보정값을 전달합니다.
        `window.windowApi.onViewportCorrection(callback)` 으로 구독합니다.
      responses:
        '200':
          description: 뷰포트 보정 정보
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ViewportCorrection'

components:
  schemas:
    # ──────────────────────────────────────
    # 이벤트 관련 스키마
    # ──────────────────────────────────────

    CalendarEvent:
      type: object
      description: 캘린더 이벤트 (출력 모델)
      required:
        - localId
        - googleEventId
        - eventType
        - summary
        - description
        - location
        - startAtUtc
        - endAtUtc
        - timeZone
        - attendees
        - recurrenceRule
        - recurringEventId
        - originalStartTimeUtc
        - organizerEmail
        - hangoutLink
        - googleUpdatedAtUtc
        - localEditedAtUtc
        - syncState
      properties:
        localId:
          type: string
          minLength: 1
          description: 로컬 고유 식별자 (UUID)
          example: 550e8400-e29b-41d4-a716-446655440000
        googleEventId:
          type: string
          nullable: true
          minLength: 1
          description: Google Calendar 이벤트 ID (미동기화 시 null)
          example: abc123def456
        eventType:
          $ref: '#/components/schemas/EventType'
        summary:
          type: string
          minLength: 1
          description: 이벤트 제목
          example: 팀 미팅
        description:
          type: string
          description: |
            이벤트 상세 설명.
            이벤트 타입에 따라 구조화된 메타데이터가 접두사 패턴으로 포함될 수 있습니다:
            - 교육: `교육대상: 홍길동, 김철수\n실제 설명`
            - 휴가: `휴가대상: 홍길동\n휴가종류: 연차\n실제 설명`
            - 시간 메모: `시각: 09:00~12:00\n실제 설명`
          example: "휴가대상: 홍길동, 김철수\n휴가종류: 연차"
        location:
          type: string
          description: 장소
          example: 회의실 A
        startAtUtc:
          type: string
          format: date-time
          description: 시작 시각 (UTC ISO 8601)
          example: '2026-03-10T01:00:00.000Z'
        endAtUtc:
          type: string
          format: date-time
          description: 종료 시각 (UTC ISO 8601)
          example: '2026-03-10T02:00:00.000Z'
        timeZone:
          type: string
          minLength: 1
          description: IANA 타임존
          example: Asia/Seoul
        attendees:
          type: array
          items:
            type: string
            format: email
          description: 참석자 이메일 목록
          example: [user1@example.com, user2@example.com]
        recurrenceRule:
          type: string
          nullable: true
          description: |
            RFC 5545 RRULE 문자열 (반복 일정 마스터에만 존재).
            지원 속성: FREQ, INTERVAL, COUNT, UNTIL, BYDAY, BYMONTHDAY, BYSETPOS
          example: 'FREQ=WEEKLY;BYDAY=MO,WE,FR'
        recurringEventId:
          type: string
          nullable: true
          minLength: 1
          description: |
            반복 시리즈 마스터의 Google 이벤트 ID.
            이 값이 존재하면 해당 이벤트는 반복 시리즈의 개별 인스턴스입니다.
          example: master_event_google_id
        originalStartTimeUtc:
          type: string
          format: date-time
          nullable: true
          description: |
            반복 인스턴스의 원래 시작 시각 (UTC).
            인스턴스가 수정되어 시간이 변경된 경우에도 원래 시작 시각을 보존합니다.
          example: '2026-03-10T01:00:00.000Z'
        organizerEmail:
          type: string
          nullable: true
          description: 주최자 이메일
          example: organizer@example.com
        hangoutLink:
          type: string
          format: uri
          nullable: true
          description: Google Meet 링크
          example: https://meet.google.com/abc-defg-hij
        googleUpdatedAtUtc:
          type: string
          format: date-time
          nullable: true
          description: Google에서 마지막 수정된 시각 (UTC). 충돌 해결에 사용.
          example: '2026-03-10T01:30:00.000Z'
        localEditedAtUtc:
          type: string
          format: date-time
          description: 로컬에서 마지막 수정된 시각 (UTC). 충돌 해결에 사용.
          example: '2026-03-10T01:25:00.000Z'
        syncState:
          $ref: '#/components/schemas/SyncState'

    EventType:
      type: string
      minLength: 1
      maxLength: 40
      default: 일반
      description: |
        이벤트 분류 타입. 사용자 정의 문자열을 사용할 수 있으며,
        앱에서 특별히 처리하는 기본 타입은 다음과 같습니다:

        | 타입 | 설명 | 특수 동작 |
        |------|------|-----------|
        | `일반` | 기본 일정 | 없음 |
        | `근무` | 교대근무 | 주간/야간 팀 파싱, 오늘의 근무 요약에 표시 |
        | `휴가` | 휴가 | 대상자/종류 메타데이터, 주간 근무자에서 제외 |
        | `교육` | 교육 | 대상자 메타데이터 |
        | `반복업무` | 루틴 | 완료 체크박스 표시 (localStorage) |
        | `공휴일` | 법정공휴일 | 한국 공휴일 캘린더 연동, 주말과 동일 취급 |

        Google Calendar에는 `extendedProperties.private.shiftCalendarEventType`으로 저장됩니다.
      enum:
        - 일반
        - 근무
        - 휴가
        - 교육
        - 반복업무
        - 공휴일
      example: 일반

    SyncState:
      type: string
      enum: [CLEAN, PENDING, ERROR]
      description: |
        동기화 상태:
        - `CLEAN`: Google과 동기화 완료
        - `PENDING`: Outbox에 대기 중인 변경 있음
        - `ERROR`: 동기화 실패 (재시도 대기 중)
      example: CLEAN

    SendUpdates:
      type: string
      enum: [all, none]
      default: none
      description: |
        Google Calendar 참석자 알림 설정:
        - `all`: 모든 참석자에게 초대/업데이트 이메일 발송
        - `none`: 이메일 발송하지 않음
      example: none

    RecurrenceEditScope:
      type: string
      enum: [THIS, ALL, FUTURE]
      default: ALL
      description: |
        반복 일정 편집 범위:
        - `THIS`: 이 일정만 수정 (개별 인스턴스 override)
        - `ALL`: 모든 일정 수정 (전체 시리즈)
        - `FUTURE`: 이 일정부터 이후 전체 수정 (시리즈 분할)
      example: ALL

    OutboxOperation:
      type: string
      enum: [CREATE, PATCH, DELETE, RECUR_THIS, RECUR_ALL, RECUR_FUTURE]
      description: |
        Outbox 동기화 작업 유형:
        - `CREATE`: 새 이벤트 생성 → Google
        - `PATCH`: 기존 이벤트 수정 → Google
        - `DELETE`: 이벤트 삭제 → Google
        - `RECUR_THIS`: 반복 시리즈의 단일 인스턴스 수정
        - `RECUR_ALL`: 반복 시리즈 전체 수정
        - `RECUR_FUTURE`: 반복 시리즈 분할 (마스터 RRULE 변경)

    # ──────────────────────────────────────
    # 입력 스키마
    # ──────────────────────────────────────

    ListEventsInput:
      type: object
      description: 이벤트 목록 조회 필터
      properties:
        rangeStartUtc:
          type: string
          format: date-time
          description: 조회 시작 시각 (UTC). 이 시각 이후에 끝나는 이벤트 포함.
          example: '2026-03-01T00:00:00.000Z'
        rangeEndUtc:
          type: string
          format: date-time
          description: 조회 종료 시각 (UTC). 이 시각 이전에 시작하는 이벤트 포함.
          example: '2026-04-01T00:00:00.000Z'

    UpsertCalendarEventInput:
      type: object
      description: 이벤트 생성/수정 입력
      required:
        - summary
        - startAtUtc
        - endAtUtc
        - timeZone
      properties:
        localId:
          type: string
          minLength: 1
          description: 수정 시 기존 이벤트의 localId. 생략하면 새 이벤트 생성.
        googleEventId:
          type: string
          nullable: true
          minLength: 1
          description: Google Calendar 이벤트 ID
        eventType:
          $ref: '#/components/schemas/EventType'
        summary:
          type: string
          minLength: 1
          description: 이벤트 제목 (공백 자동 제거)
        description:
          type: string
          default: ''
          description: |
            이벤트 상세 설명.
            타입별 구조화 메타데이터를 포함할 수 있습니다:
            - 교육: 첫 줄에 `교육대상: 이름1, 이름2`
            - 휴가: `휴가대상: 이름1, 이름2\n휴가종류: 연차`
            - 시간 메모: `시각: 09:00~12:00`
        location:
          type: string
          default: ''
          description: 장소
        startAtUtc:
          type: string
          format: date-time
          description: 시작 시각 (UTC ISO 8601)
        endAtUtc:
          type: string
          format: date-time
          description: 종료 시각 (UTC ISO 8601)
        timeZone:
          type: string
          minLength: 1
          description: IANA 타임존
          example: Asia/Seoul
        attendees:
          type: array
          items:
            type: string
            format: email
          default: []
          description: 참석자 이메일 목록
        recurrenceRule:
          type: string
          nullable: true
          description: |
            RFC 5545 RRULE 문자열.
            지원 주기: DAILY, WEEKLY, MONTHLY, YEARLY.
            지원 속성: FREQ, INTERVAL, COUNT, UNTIL, BYDAY, BYMONTHDAY, BYSETPOS.

            예시:
            - 매일: `FREQ=DAILY`
            - 매주 월수금: `FREQ=WEEKLY;BYDAY=MO,WE,FR`
            - 매월 15일: `FREQ=MONTHLY;BYMONTHDAY=15`
            - 매월 둘째 화요일: `FREQ=MONTHLY;BYDAY=TU;BYSETPOS=2`
            - 매년: `FREQ=YEARLY`
            - 10회 반복: `FREQ=WEEKLY;BYDAY=MO;COUNT=10`
            - 특정 날짜까지: `FREQ=DAILY;UNTIL=20261231T235959Z`
          example: 'FREQ=WEEKLY;BYDAY=MO,WE,FR'
        recurringEventId:
          type: string
          nullable: true
          minLength: 1
          description: 반복 시리즈 마스터의 Google 이벤트 ID
        originalStartTimeUtc:
          type: string
          format: date-time
          nullable: true
          description: 반복 인스턴스의 원래 시작 시각 (UTC)
        sendUpdates:
          $ref: '#/components/schemas/SendUpdates'
        recurrenceScope:
          $ref: '#/components/schemas/RecurrenceEditScope'

    DeleteCalendarEventInput:
      type: object
      description: 이벤트 삭제 입력
      required:
        - localId
      properties:
        localId:
          type: string
          minLength: 1
          description: 삭제할 이벤트의 localId
        sendUpdates:
          $ref: '#/components/schemas/SendUpdates'
        recurrenceScope:
          $ref: '#/components/schemas/RecurrenceEditScope'

    # ──────────────────────────────────────
    # 동기화 관련 스키마
    # ──────────────────────────────────────

    SyncResult:
      type: object
      description: 동기화 실행 결과
      required:
        - mode
        - pulledEvents
        - pushedOutboxJobs
        - outboxRemaining
      properties:
        mode:
          type: string
          enum: [FULL, DELTA, SKIPPED]
          description: |
            동기화 모드:
            - `FULL`: 전체 이벤트 재동기화 (초기 또는 syncToken 만료 시)
            - `DELTA`: 증분 동기화 (syncToken 기반)
            - `SKIPPED`: 동기화 건너뜀 (미연결 또는 캘린더 미선택)
        pulledEvents:
          type: integer
          minimum: 0
          description: 원격에서 가져온 이벤트 수
        pushedOutboxJobs:
          type: integer
          minimum: 0
          description: 처리된 Outbox 작업 수
        outboxRemaining:
          type: integer
          minimum: 0
          description: 남은 Outbox 작업 수

    # ──────────────────────────────────────
    # Google 연결 관련 스키마
    # ──────────────────────────────────────

    GoogleConnectionStatus:
      type: object
      description: Google OAuth 연결 상태
      required:
        - connected
        - accountEmail
      properties:
        connected:
          type: boolean
          description: Google 계정 연결 여부
        accountEmail:
          type: string
          format: email
          nullable: true
          description: 연결된 Google 계정 이메일 (미연결 시 null)

    GoogleCalendarItem:
      type: object
      description: Google 캘린더 항목
      required:
        - id
        - summary
        - primary
        - accessRole
      properties:
        id:
          type: string
          minLength: 1
          description: Google 캘린더 ID
          example: primary
        summary:
          type: string
          minLength: 1
          description: 캘린더 이름
          example: 내 캘린더
        primary:
          type: boolean
          description: 기본(primary) 캘린더 여부
        accessRole:
          type: string
          nullable: true
          description: 접근 권한 (`owner` 또는 `writer`만 반환)
          enum: [owner, writer]
          example: owner

    # ──────────────────────────────────────
    # 캘린더 선택 관련 스키마
    # ──────────────────────────────────────

    SelectedCalendar:
      type: object
      description: 현재 선택된 동기화 대상 캘린더
      required:
        - calendarId
        - calendarSummary
      properties:
        calendarId:
          type: string
          nullable: true
          minLength: 1
          description: 선택된 Google 캘린더 ID (미선택 시 null)
          example: primary
        calendarSummary:
          type: string
          nullable: true
          description: 선택된 캘린더 이름
          example: 내 캘린더

    SetSelectedCalendarInput:
      type: object
      description: 캘린더 선택 입력
      required:
        - calendarId
      properties:
        calendarId:
          type: string
          minLength: 1
          description: 선택할 Google 캘린더 ID
          example: primary
        calendarSummary:
          type: string
          nullable: true
          minLength: 1
          description: 캘린더 이름 (표시용)
          example: 내 캘린더

    # ──────────────────────────────────────
    # 교대근무 설정 관련 스키마
    # ──────────────────────────────────────

    ShiftSettings:
      type: object
      description: |
        교대근무 설정.
        4개 팀(A/B/C/D)이 주간/야간/비번/비번 순환으로 교대합니다.
      required:
        - shiftType
        - shiftTeamMode
        - dayWorkerCount
        - teams
        - dayWorkers
      properties:
        shiftType:
          $ref: '#/components/schemas/ShiftType'
        shiftTeamMode:
          $ref: '#/components/schemas/ShiftTeamMode'
        dayWorkerCount:
          type: integer
          minimum: 1
          maximum: 5
          description: 주간 근무자 수
          example: 2
        teams:
          $ref: '#/components/schemas/ShiftTeamAssignments'
        dayWorkers:
          type: array
          items:
            type: string
            minLength: 1
            maxLength: 40
          maxItems: 5
          description: 주간 근무자 이름 목록 (주말/공휴일에는 표시 제외)
          example: [한미래, 오태양]

    ShiftType:
      type: string
      enum: [DAY_NIGHT_OFF_OFF]
      description: |
        교대근무 패턴:
        - `DAY_NIGHT_OFF_OFF`: 주간 → 야간 → 비번 → 비번 순환
      example: DAY_NIGHT_OFF_OFF

    ShiftTeamMode:
      type: string
      enum: [SINGLE, PAIR]
      description: |
        팀 구성 모드:
        - `SINGLE`: 팀당 1명
        - `PAIR`: 팀당 2명
      example: PAIR

    ShiftTeamAssignments:
      type: object
      description: 4개 교대 팀의 멤버 배정
      required: [A, B, C, D]
      properties:
        A:
          type: array
          items:
            type: string
            minLength: 1
            maxLength: 40
          maxItems: 2
          description: A팀 멤버
          example: [홍길동, 김철수]
        B:
          type: array
          items:
            type: string
            minLength: 1
            maxLength: 40
          maxItems: 2
          description: B팀 멤버
          example: [이영희, 박민수]
        C:
          type: array
          items:
            type: string
            minLength: 1
            maxLength: 40
          maxItems: 2
          description: C팀 멤버
          example: [최수연, 정대현]
        D:
          type: array
          items:
            type: string
            minLength: 1
            maxLength: 40
          maxItems: 2
          description: D팀 멤버
          example: [강지은, 윤서준]

    # ──────────────────────────────────────
    # 윈도우 관련 스키마
    # ──────────────────────────────────────

    ViewportCorrection:
      type: object
      description: |
        윈도우 최대화/전체화면 시 OS 인셋 보정값.
        WSL/Windows에서 최대화 시 발생하는 레이아웃 오프셋을 보정합니다.
      required:
        - active
        - offsetX
        - offsetY
        - extraWidth
        - extraHeight
      properties:
        active:
          type: boolean
          description: 보정 활성화 여부
        offsetX:
          type: number
          description: X축 오프셋 (픽셀)
        offsetY:
          type: number
          description: Y축 오프셋 (픽셀)
        extraWidth:
          type: number
          description: 추가 너비 (픽셀)
        extraHeight:
          type: number
          description: 추가 높이 (픽셀)

    # ──────────────────────────────────────
    # 내부 모델 (참고용)
    # ──────────────────────────────────────

    RemoteEventSnapshot:
      type: object
      description: |
        Google Calendar에서 가져온 이벤트 스냅샷 (내부 모델).
        `calendarService.pullRemoteEvents()`의 반환 항목입니다.
        직접 IPC로 노출되지 않으며, 동기화 엔진 내부에서 사용됩니다.
      required:
        - googleEventId
        - eventType
        - summary
        - description
        - location
        - startAtUtc
        - endAtUtc
        - timeZone
        - recurrenceRule
        - recurringEventId
        - originalStartTimeUtc
        - attendees
        - organizerEmail
        - hangoutLink
        - googleUpdatedAtUtc
        - isDeleted
      properties:
        googleEventId:
          type: string
          description: Google Calendar 이벤트 ID
        eventType:
          type: string
          description: extendedProperties에서 추출된 이벤트 타입
        summary:
          type: string
        description:
          type: string
        location:
          type: string
        startAtUtc:
          type: string
          format: date-time
        endAtUtc:
          type: string
          format: date-time
        timeZone:
          type: string
        recurrenceRule:
          type: string
          nullable: true
        recurringEventId:
          type: string
          nullable: true
        originalStartTimeUtc:
          type: string
          format: date-time
          nullable: true
        attendees:
          type: array
          items:
            type: string
            format: email
        organizerEmail:
          type: string
          nullable: true
        hangoutLink:
          type: string
          format: uri
          nullable: true
        googleUpdatedAtUtc:
          type: string
          format: date-time
        isDeleted:
          type: boolean
          description: Google에서 삭제(cancelled)된 이벤트 여부

    OutboxJob:
      type: object
      description: |
        Outbox 동기화 작업 항목 (내부 모델).
        직접 IPC로 노출되지 않으며, 동기화 워커 내부에서 사용됩니다.
      properties:
        id:
          type: string
          description: Outbox 작업 ID
        eventLocalId:
          type: string
          description: 대상 이벤트의 localId
        operation:
          $ref: '#/components/schemas/OutboxOperation'
        payload:
          $ref: '#/components/schemas/OutboxPayload'
        status:
          type: string
          enum: [QUEUED, RUNNING, DONE, FAILED, CANCELLED]
          description: |
            작업 상태:
            - `QUEUED`: 대기 중
            - `RUNNING`: 실행 중
            - `DONE`: 완료
            - `FAILED`: 실패 (재시도 대기)
            - `CANCELLED`: 취소 (충돌 해결로 폐기)
        retryCount:
          type: integer
          minimum: 0
          description: 재시도 횟수
        dependsOnOutboxId:
          type: string
          nullable: true
          description: 의존하는 선행 작업 ID (FUTURE 분할 시 사용)

    OutboxPayload:
      type: object
      description: Outbox 작업의 추가 페이로드
      properties:
        sendUpdates:
          $ref: '#/components/schemas/SendUpdates'
        googleEventId:
          type: string
          nullable: true
          description: 대상 Google 이벤트 ID
        recurringEventId:
          type: string
          nullable: true
          description: 반복 시리즈 마스터의 Google 이벤트 ID (RECUR_THIS/RECUR_FUTURE)
        originalStartTimeUtc:
          type: string
          format: date-time
          nullable: true
          description: 반복 인스턴스 원래 시작 시각 (RECUR_THIS)
        splitStartUtc:
          type: string
          format: date-time
          description: 시리즈 분할 시작 시각 (RECUR_FUTURE)

    # ──────────────────────────────────────
    # Description 메타데이터 패턴 (참고용)
    # ──────────────────────────────────────

    EducationDescriptionFormat:
      type: string
      description: |
        **교육 이벤트 description 형식**

        교육 대상자 정보를 description 첫 줄에 접두사 패턴으로 저장합니다.

        ```
        교육대상: 홍길동, 김철수
        교육 내용 상세 설명...
        ```

        파싱: `app/src/renderer/utils/parseEducationTargets.ts`
      example: "교육대상: 홍길동, 김철수\n소방 안전 교육 실시"

    VacationDescriptionFormat:
      type: string
      description: |
        **휴가 이벤트 description 형식**

        휴가 대상자 및 종류를 description에 접두사 패턴으로 저장합니다.

        ```
        휴가대상: 홍길동, 김철수
        휴가종류: 연차
        추가 메모...
        ```

        **휴가 종류 프리셋:** 장기휴가, 연차, 대휴, 시간차
        (프리셋 외 사용자 정의 종류도 입력 가능)

        **시간차 휴가 시 시간 메모:**
        ```
        휴가대상: 홍길동
        휴가종류: 시간차
        시각: 09:00~12:00
        ```

        파싱: `app/src/renderer/utils/parseVacationInfo.ts`
      example: "휴가대상: 홍길동\n휴가종류: 연차"

    ShiftSummaryFormat:
      type: string
      description: |
        **근무 이벤트 summary 형식**

        근무 이벤트의 제목(summary)에서 주간/야간 팀 정보를 파싱합니다.

        형식: `주간{팀} 야간{팀}` 또는 `주간{팀}{팀} 야간{팀}{팀}`

        예시:
        - `주간A 야간B` → 주간: A팀, 야간: B팀
        - `주간AB 야간CD` → 주간: A팀+B팀, 야간: C팀+D팀
      example: '주간A 야간B'
